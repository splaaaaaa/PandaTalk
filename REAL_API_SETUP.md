# 真实API配置说明

## 概述
本应用已经完全配置为使用真实的讯飞语音评测API，所有数据都将通过API获取，不再使用模拟数据。

## 已完成的配置

### 1. API密钥配置
- 文件位置：`config/api-config.ts`
- 已配置真实的讯飞API密钥：
  - APPID: `a696bc26`
  - API_SECRET: `ZDQxMGYzNmQ2ZTg4NWNjOTY2MjhiZjI3`
  - API_KEY: `761d772b70b55f9225c5e55b89c58963`

### 2. 语音评测服务
- 文件位置：`services/speech-recognition.ts`
- 已实现完整的WebSocket连接
- 已实现HMAC-SHA256认证
- 已实现音频数据分块发送
- 已实现真实API结果解析

### 3. 移除的模拟功能
- ✅ 移除了`mockEvaluateSpeech`方法
- ✅ 移除了`parseMockResult`方法
- ✅ 移除了硬编码的模拟分数
- ✅ 移除了模拟API调用逻辑

## 数据流程

### 1. 录音流程
```
用户录音 → 音频文件 → Base64编码 → ArrayBuffer → 分块发送到讯飞API
```

### 2. API调用流程
```
建立WebSocket连接 → 发送评测配置 → 分块发送音频 → 接收XML结果 → 解析评分数据
```

### 3. 结果展示流程
```
API返回数据 → 解析XML → 提取评分 → 传递到Result页面 → 显示真实评分
```

## 评分维度

所有评分都来自讯飞API的真实评测结果：

- **总体评分** (`overall_score`): 综合评分
- **发音清晰度** (`pronunciation_score`): 发音准确度
- **语速控制** (`fluency_score`): 流利度
- **声调准确度** (`tone_score`): 声调正确性
- **完整性** (`integrity_score`): 内容完整性
- **准确度** (`accuracy_score`): 整体准确度
- **情感表达** (`emotion_score`): 情感表现

## 注意事项

### 1. 网络要求
- 需要稳定的网络连接
- 需要能够访问讯飞API服务器
- WebSocket连接需要保持稳定

### 2. API限制
- 讯飞API有调用频率限制
- 音频文件大小有限制
- 需要有效的API密钥

### 3. 错误处理
- 网络错误会自动重试
- API错误会显示具体错误信息
- 连接超时会自动关闭

## 测试验证

### 1. 检查真实API调用
在控制台中应该看到：
```
🚀 调用真实讯飞API...
🚀 开始语音评测流程...
🔌 尝试连接到: wss://ise-api.xfyun.cn/v2/open-ise
📤 发送配置...
📤 发送音频数据...
📥 收到消息: {...}
✅ 评测完成: {...}
```

### 2. 检查数据来源
- 所有分数都应该来自API响应
- 不应该有固定的模拟分数
- 每次评测结果可能不同

## 故障排除

### 1. 如果API调用失败
- 检查网络连接
- 验证API密钥是否有效
- 检查音频文件格式是否正确

### 2. 如果结果解析失败
- 检查API响应格式
- 验证XML解析逻辑
- 查看控制台错误信息

### 3. 如果连接超时
- 检查网络延迟
- 验证WebSocket连接
- 可能需要调整超时设置

## 总结

应用已经完全配置为使用真实API，所有语音评测数据都将通过讯飞API获取，确保用户获得准确的语音评测结果。模拟数据已被完全移除，应用现在完全依赖真实的语音评测服务。
