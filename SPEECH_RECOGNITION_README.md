# 🎤 语音识别功能使用说明

## ✨ 功能概述

Pandatalk应用已集成讯飞语音评测API，可以为用户提供专业的绕口令发音评测服务。

### 主要功能
- 🎵 **实时录音**：支持点击按钮开始/停止录音
- 🔍 **语音识别**：录音完成后自动调用讯飞API进行评测
- 📊 **详细评分**：提供多维度评分（发音准确度、流利度、完整度、语调等）
- 📝 **单词分析**：显示每个单词的详细评测结果和错误分析
- 🎯 **等级评定**：根据总分自动评定等级（优秀、良好、一般、需改进）

## 🚀 快速开始

### 1. 配置讯飞API密钥

#### 获取API密钥
1. 访问 [讯飞开放平台](https://www.xfyun.cn/)
2. 注册账号并登录
3. 创建新应用，选择「语音评测」服务
4. 获取 `APPID`、`API_SECRET`、`API_KEY`

#### 配置方式

**方式一：直接修改配置文件**
编辑 `config/api-config.ts` 文件：

```typescript
export const xfyunConfig: XFYunConfig = {
  APPID: 'your_actual_appid',        // 替换为您的实际APPID
  API_SECRET: 'your_actual_secret',  // 替换为您的实际API_SECRET
  API_KEY: 'your_actual_key',        // 替换为您的实际API_KEY
  BASE_URL: 'wss://ise-api.xfyun.cn/v2/open-ise'
};
```

**方式二：使用环境变量**
创建 `.env` 文件（注意：不要提交到版本控制）：

```bash
EXPO_PUBLIC_XFYUN_APPID=your_actual_appid
EXPO_PUBLIC_XFYUN_API_SECRET=your_actual_secret
EXPO_PUBLIC_XFYUN_API_KEY=your_actual_key
```

### 2. 使用语音识别功能

#### 基本流程
1. **进入练习页面**：从首页点击"开始挑战"按钮
2. **开始录音**：点击录音按钮开始录制绕口令
3. **停止录音**：再次点击按钮停止录音
4. **等待评测**：系统自动调用API进行语音评测
5. **查看结果**：在内容卡片中显示详细的评测结果

#### 录音要求
- **时长**：建议3-30秒
- **环境**：安静的环境，避免背景噪音
- **音量**：保持适当的录音音量
- **清晰度**：清晰地发音每个音节

## 📊 评测结果说明

### 评分维度

| 维度 | 说明 | 满分 |
|------|------|------|
| **总分** | 综合评分 | 100分 |
| **发音准确度** | 音素发音的准确性 | 100分 |
| **流利度** | 朗读的流畅程度 | 100分 |
| **完整度** | 朗读内容的完整性 | 100分 |
| **语调** | 声调的准确性 | 100分 |

### 等级评定

| 等级 | 分数范围 | 说明 |
|------|----------|------|
| 🏆 **优秀** | 90-100分 | 发音标准，语调自然 |
| 👍 **良好** | 80-89分 | 发音较好，略有瑕疵 |
| ⚠️ **一般** | 70-79分 | 发音基本正确，需要练习 |
| 🔴 **需改进** | 0-69分 | 发音问题较多，建议加强练习 |

### 单词分析
- **内容**：显示汉字内容
- **拼音**：显示标准拼音
- **错误分析**：如有发音错误，会显示具体的错误类型和级别

## 🔧 技术实现

### 架构设计
```
练习页面 (practice.tsx)
    ↓
语音识别服务 (speech-recognition.ts)
    ↓
讯飞API客户端 (xfyun_client.py)
    ↓
讯飞语音评测API
```

### 核心组件

#### 1. 练习页面 (`app/practice.tsx`)
- 录音控制界面
- 评测结果显示
- 用户交互逻辑

#### 2. 语音识别服务 (`services/speech-recognition.ts`)
- API调用封装
- 结果解析处理
- 错误处理机制

#### 3. API配置 (`config/api-config.ts`)
- 讯飞API配置
- 音频参数设置
- 评分等级定义

### 音频处理流程
1. **录音采集**：使用React Native录音API
2. **格式转换**：转换为讯飞API要求的PCM格式
3. **分块传输**：按40ms分块发送音频数据
4. **结果接收**：接收并解析XML格式的评测结果
5. **结果展示**：在UI中展示详细的评测信息

## 🐛 常见问题

### Q: 录音失败怎么办？
**A:** 检查以下项目：
- 麦克风权限是否已授权
- 设备麦克风是否正常工作
- 录音环境是否过于嘈杂

### Q: API调用失败？
**A:** 检查以下项目：
- API密钥是否正确配置
- 网络连接是否正常
- 讯飞账户是否有足够的调用次数

### Q: 评分结果不准确？
**A:** 建议：
- 在安静环境中录音
- 保持适当的录音音量
- 清晰地发音每个音节
- 确保麦克风质量良好

### Q: 如何提高评分？
**A:** 练习建议：
- 多听标准发音
- 练习声调变化
- 注意音素发音
- 保持朗读节奏

## 🔮 未来计划

### 功能增强
- [ ] 支持更多语言
- [ ] 添加发音纠正建议
- [ ] 历史记录管理
- [ ] 个性化练习计划

### 技术优化
- [ ] 实时语音识别
- [ ] 离线语音评测
- [ ] 多设备同步
- [ ] 性能优化

## 📞 技术支持

如果遇到问题，请：
1. 检查API配置是否正确
2. 查看控制台错误信息
3. 确认网络连接正常
4. 联系技术支持团队

---

🎉 **祝您使用愉快！让我们一起在绕口令的世界中提升语言技能吧！** 🎉

