# 录音测评成绩为0的问题诊断

## 问题描述
录音测评成绩一直显示为0，可能是API连接、配置或代码逻辑的问题。

## 可能的原因分析

### 1. API连接问题
- **WebSocket连接失败**: 网络问题或API地址错误
- **认证失败**: API密钥、密钥或APPID不正确
- **连接超时**: 网络延迟或API服务响应慢

### 2. 音频数据问题
- **音频格式不正确**: 需要16kHz, 16bit, 单声道PCM格式
- **音频数据损坏**: 录音过程中出现问题
- **音频长度过短**: 录音时间太短，无法进行有效评测

### 3. API响应解析问题
- **XML格式不匹配**: 实际API返回的XML结构与代码中期望的不一致
- **正则表达式错误**: 评分提取的正则表达式无法匹配实际数据
- **状态码错误**: API返回的状态码不是预期的成功状态

### 4. 配置问题
- **API配置错误**: 密钥、密钥或APPID配置不正确
- **音频参数不匹配**: 音频配置与API要求不一致

## 诊断步骤

### 第一步：检查控制台日志
1. 打开浏览器开发者工具或React Native调试器
2. 查看控制台中的详细日志信息
3. 特别关注以下日志：
   - 🔗 尝试连接到讯飞API
   - ✅ WebSocket连接已建立
   - 📤 评测配置已发送
   - 📤 音频数据已发送
   - 📥 收到讯飞API消息
   - 🔍 开始解析XML评分数据

### 第二步：使用调试页面
1. 在个人档案页面点击"API调试"按钮
2. 进入调试页面，查看API配置信息
3. 点击"开始测试"按钮进行API连接测试
4. 观察测试结果和错误信息

### 第三步：检查网络连接
1. 确保设备网络连接正常
2. 检查是否有防火墙或代理限制
3. 尝试在不同的网络环境下测试

### 第四步：验证API配置
1. 检查 `config/api-config.ts` 中的配置
2. 确认APPID、API_KEY、API_SECRET是否正确
3. 验证API密钥是否有效且未过期

## 常见错误及解决方案

### 错误1: WebSocket连接失败
```
❌ WebSocket连接错误
❌ 错误详情: {...}
```

**解决方案**:
- 检查网络连接
- 验证API地址是否正确
- 确认API密钥是否有效

### 错误2: 认证失败
```
❌ API返回错误码: 10001
❌ 错误信息: 认证失败
```

**解决方案**:
- 检查APPID是否正确
- 验证API_KEY和API_SECRET是否匹配
- 确认API密钥是否已激活

### 错误3: 音频格式错误
```
❌ 音频发送失败
```

**解决方案**:
- 确保音频格式为16kHz, 16bit, 单声道PCM
- 检查音频数据是否完整
- 验证音频长度是否足够

### 错误4: XML解析失败
```
❌ 未找到总体评分
❌ 未找到发音评分
```

**解决方案**:
- 检查API返回的XML结构
- 更新正则表达式以匹配实际格式
- 查看原始XML数据内容

## 调试工具使用

### API调试页面功能
1. **配置信息显示**: 显示当前使用的API配置
2. **连接测试**: 测试WebSocket连接和API调用
3. **详细日志**: 显示测试过程中的详细信息
4. **错误诊断**: 提供具体的错误信息和解决建议

### 使用步骤
1. 进入个人档案页面
2. 点击"API调试"按钮
3. 查看API配置信息
4. 点击"开始测试"按钮
5. 观察测试结果和日志
6. 根据错误信息进行相应修复

## 预防措施

### 1. 定期检查API状态
- 监控API调用成功率
- 检查API密钥有效期
- 关注API服务状态更新

### 2. 完善错误处理
- 添加重试机制
- 实现降级方案
- 提供用户友好的错误提示

### 3. 日志监控
- 记录详细的API调用日志
- 监控关键指标
- 及时发现和解决问题

## 联系支持

如果问题仍然存在，请：
1. 收集完整的错误日志
2. 记录问题发生的具体步骤
3. 提供设备信息和网络环境
4. 联系技术支持团队

## 总结

录音测评成绩为0的问题通常由以下原因引起：
- API连接问题（网络、认证、超时）
- 音频数据问题（格式、质量、长度）
- 响应解析问题（XML格式、正则表达式）
- 配置问题（密钥、参数、设置）

通过使用提供的调试工具和诊断步骤，可以快速定位和解决问题。建议在开发过程中保持详细的日志记录，以便及时发现问题并进行修复。
